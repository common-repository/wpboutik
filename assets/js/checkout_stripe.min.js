jQuery(document).ready(function(u){const m=Stripe(ajax_var_checkout.stripe_public_key);let t,h,y,g;function e(){u.ajax({type:"post",url:ajax_var_checkout.url,data:{action:"wpboutik_ajax_checkout_stripe_elements",method_shipping_id:u("input[type=radio][name=delivery-method]:checked").val(),shipping_country_key:u("#shipping_country").val(),datas:u("#checkout_form").serialize(),nonce:ajax_var_checkout.nonce},success:function(e){y=e.data.clientSecret;t=m.elements({clientSecret:y,appearance:{theme:"stripe"}}),(h=t.create("card")).mount("#card-element"),window._customer_stripe=e.customer}})}function v(e){e?(document.querySelector("#card-button").disabled=!0,document.querySelector("#spinner").classList.remove("hidden")):(document.querySelector("#card-button").disabled=!1,document.querySelector("#spinner").classList.add("hidden"))}!async function(){"card"==u("input[type=radio][name=payment-type]:checked").attr("id")&&e()}(),u("input[type=radio][name=payment-type]").change(function(){"card"==u(this).attr("id")&&(u("#cardstripe").show(),u("#paypaldiv").hide(),u("#bacsdiv").hide(),"card"==u("input[type=radio][name=payment-type]:checked").attr("id")&&e(),u.ajax({type:"post",url:ajax_var_checkout.url,data:{action:"wpboutik_ajax_checkout_change_payment_type",shipping_country_key:u("#shipping_country").val(),shipping_postal_code:u("#shipping_postal_code").val(),shipping_city:u("#shipping_city").val(),shipping_company:u("#shipping_company").val(),shipping_address:u("#shipping_address").val(),method_shipping_id:u("input[type=radio][name=delivery-method]:checked").val(),nonce:u(this).data("nonce")}}))}),u("#card-element").on("change",({error:e})=>{var t=document.getElementById("card-errors");t.textContent=e?e.message:""}),u("#email_address").change(function(){/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(u(this).val())&&e()}),u(".create_order").on("click",function(e){if(console.log("customer id is : "+window._customer_stripe),"card"===u("input[type=radio][name=payment-type]:checked").attr("id")){e.preventDefault(),v(!0);var t,a={},n={shipping_first_name:["shipping_first_name",ajax_var_checkout.shipping_first_name_required_label,/^[a-zA-Z0-9]+$/,"First Name must be letters only"],shipping_last_name:["shipping_last_name",ajax_var_checkout.shipping_last_name_required_label,/^[a-zA-Z0-9]+$/,"Last Name must be letters only"],email_address:["email_address",ajax_var_checkout.email_address_required_label,/^[a-zA-Z0-9+.]+@[a-zA-Z0-9]+\.[a-zA-Z0-9]+$/,"Email must be a valid email"],shipping_address:["shipping_address",ajax_var_checkout.shipping_address_required_label,/^\s*\S+(?:\s+\S+){2}/,"Address must be letters only"],shipping_city:["shipping_city",ajax_var_checkout.shipping_city_required_label,/^[a-zA-Z]+$/,"City must be letters only"],shipping_country:["shipping_country",ajax_var_checkout.shipping_country_required_label,/^[a-zA-Z0-9]+$/,"Country must be letters only"],shipping_postal_code:["shipping_postal_code",ajax_var_checkout.shipping_postal_code_required_label,/^[0-9]+$/,"Postal code must be numerics only"],shipping_phone:["shipping_phone",ajax_var_checkout.shipping_phone_required_label,/^[0-9]+$/,"Phone must be numerics only"],terms:["terms","Terms is required",null,ajax_var_checkout.terms_required_label]};for(t in n){var i=n[t],r=document.getElementById(t),c=document.getElementsByClassName(i[0]+"Error")[0],s=r.value.trim();c.classList.remove("block"),c.classList.add("hidden"),r.classList.remove("border-red-500"),"terms"!==t||r.checked?""===s?a[i[0]]=i[1]:null!==i[2]&&i[2].length&&!s.match(i[2])&&(a[i[0]]=i[3]):a[t]=i[3]}var e=document.querySelector('input[name="delivery-method"]:checked'),o=document.querySelector('button[data-method-id="'+e?.value+'"]'),d=document.querySelector('.replacedButton[data-method-id="'+e?.value+'"]');if(e&&!d&&o&&(a.delivery_method=ajax_var_checkout.delivery_method_required_label),0<Object.keys(a).length){for(var _ in a){var p=document.getElementById(_),l=document.getElementsByClassName(_+"Error")[0];p&&p.length&&p.classList.add("border-red-500"),l.classList.remove("hidden"),l.classList.add("block"),l.innerHTML=a[_]}v(!1)}else{$thisbutton=u(this),nonce=$thisbutton.data("nonce");e={action:"wpboutik_ajax_create_order",datas:datas=u("#checkout_form").serialize(),nonce:nonce};u.ajax({type:"post",url:ajax_var_checkout.url,data:e,success:function(e){var t;e.success&&(g=e.order_id,"card"==e.payment_type)&&(delete(t=e.billing_details).first_name,delete t.last_name,m.createPaymentMethod({type:"card",card:h,billing_details:t}).then(function(e){e=e.paymentMethod.id;u.ajax({type:"post",url:ajax_var_checkout.url,data:{email_address:t.email,payment_id:e,nonce:ajax_var_checkout.nonce_payment_stripe,action:"wpboutik_ajax_client_stripe"},success:function(e){m.confirmCardPayment(y,{payment_method:e.payment}).then(function(e){v(!1),e.error?(console.log(e.error.message),u("#card-errors").html(e.error.message)):"succeeded"===e.paymentIntent.status?u.ajax({type:"post",url:ajax_var_checkout.url,data:{action:"wpboutik_ajax_finish_order_after_payment_stripe",payment_intent_id:e.paymentIntent.id,order_id_finish:g,nonce:ajax_var_checkout.nonce_finish},success:function(e){e.success&&setTimeout(function(){window.location.href=e.billing_details.url},1e3)}}):"canceled"===e.paymentIntent.status&&u.ajax({type:"post",url:ajax_var_checkout.url,data:{action:"wpboutik_ajax_order_cancel_payment",order_id:g,nonce:ajax_var_checkout.nonce_cancel}})})}})}))}})}}})});